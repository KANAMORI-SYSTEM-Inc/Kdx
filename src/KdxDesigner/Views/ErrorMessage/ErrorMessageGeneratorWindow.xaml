<Window
    x:Class="KdxDesigner.Views.ErrorMessage.ErrorMessageGeneratorWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="エラーメッセージ生成"
    Width="1000"
    Height="700"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 設定パネル -->
        <GroupBox Grid.Row="0" Header="生成設定" Margin="0,0,0,10">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="100" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" VerticalAlignment="Center" Text="エラー開始番号:" Margin="0,0,5,0" />
                <TextBox Grid.Column="1" Text="{Binding StartErrorNum, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="Mデバイス開始:" Margin="10,0,5,0" />
                <TextBox Grid.Column="3" Text="{Binding DeviceStartM, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Column="4" VerticalAlignment="Center" Text="Tデバイス開始:" Margin="10,0,5,0" />
                <TextBox Grid.Column="5" Text="{Binding DeviceStartT, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock Grid.Column="6" VerticalAlignment="Center" Text="PLC ID:" Margin="10,0,5,0" />
                <TextBox Grid.Column="7" Text="{Binding PlcId, Mode=OneWay}" IsReadOnly="True" Background="#F0F0F0" />
            </Grid>
        </GroupBox>

        <!-- 生成対象選択 -->
        <GroupBox Grid.Row="1" Header="生成対象" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="5">
                <CheckBox Content="Interlock" IsChecked="{Binding GenerateInterlock}" Margin="0,0,20,0" IsEnabled="{Binding IsInitialized}" />
                <CheckBox Content="Operation" IsChecked="{Binding GenerateOperation}" Margin="0,0,20,0" IsEnabled="{Binding IsInitialized}" />
                <Button Content="プレビュー生成" Command="{Binding GeneratePreviewCommand}" Width="120" Margin="20,0,0,0"
                        IsEnabled="{Binding IsInitialized}" />
                <TextBlock VerticalAlignment="Center" Margin="20,0,0,0">
                    <Run Text="Interlock入力数: " />
                    <Run Text="{Binding InterlockInputCount, Mode=OneWay}" FontWeight="Bold" />
                    <Run Text="  生成エラー数: " />
                    <Run Text="{Binding GeneratedErrorCount, Mode=OneWay}" FontWeight="Bold" />
                </TextBlock>
                <TextBlock VerticalAlignment="Center" Margin="20,0,0,0" Foreground="Orange" FontWeight="Bold"
                           Visibility="{Binding IsNotInitialized, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Run Text="初期化中..." />
                </TextBlock>
            </StackPanel>
        </GroupBox>

        <!-- プレビューグリッド -->
        <GroupBox Grid.Row="2" Header="生成プレビュー (GeneratedError)">
            <DataGrid
                ItemsSource="{Binding PreviewErrors}"
                AutoGenerateColumns="False"
                IsReadOnly="True"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                SelectionMode="Single"
                GridLinesVisibility="All"
                AlternatingRowBackground="#F5F5F5">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ErrorNum" Binding="{Binding ErrorNum}" Width="70" />
                    <DataGridTextColumn Header="DeviceM" Binding="{Binding DeviceM}" Width="70" />
                    <DataGridTextColumn Header="DeviceT" Binding="{Binding DeviceT}" Width="70" />
                    <DataGridTextColumn Header="AlarmId" Binding="{Binding AlarmId}" Width="60" />
                    <DataGridTextColumn Header="Comment1" Binding="{Binding Comment1}" Width="100" />
                    <DataGridTextColumn Header="Comment2" Binding="{Binding Comment2}" Width="120" />
                    <DataGridTextColumn Header="Comment3" Binding="{Binding Comment3}" Width="120" />
                    <DataGridTextColumn Header="Comment4" Binding="{Binding Comment4}" Width="100" />
                    <DataGridTextColumn Header="AlarmComment" Binding="{Binding AlarmComment}" Width="150" />
                    <DataGridTextColumn Header="MessageComment" Binding="{Binding MessageComment}" Width="200" />
                    <DataGridTextColumn Header="ErrorTime" Binding="{Binding ErrorTime}" Width="70" />
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- ボタンパネル -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <TextBlock VerticalAlignment="Center" Margin="0,0,20,0" Foreground="Gray">
                <Run Text="※ プレビュー後、「保存」でSupabaseに保存されます" />
            </TextBlock>
            <Button Content="保存" Command="{Binding SaveErrorsCommand}" Width="100" Margin="0,0,10,0"
                    IsEnabled="{Binding CanSave}" />
            <Button Content="閉じる" Command="{Binding CloseCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" Width="100" />
        </StackPanel>
    </Grid>
</Window>