<Window
    x:Class="KdxDesigner.Views.ErrorMessage.ErrorMessageEditorWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="エラーメッセージテンプレート編集"
    Width="1100"
    Height="900"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- 左ペイン: 既存メッセージリスト -->
        <GroupBox Grid.Column="0" Header="既存のテンプレート" Margin="0,0,10,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- MnemonicType選択 -->
                <StackPanel Grid.Row="0" Margin="5">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="種別:" VerticalAlignment="Center" Margin="0,0,5,0" Width="70" />
                        <ComboBox Width="200"
                                  ItemsSource="{Binding MnemonicTypes}"
                                  SelectedItem="{Binding SelectedMnemonicType}"
                                  DisplayMemberPath="Name" />
                    </StackPanel>
                    <!-- ConditionType選択（Interlock専用） -->
                    <StackPanel Orientation="Horizontal" IsEnabled="{Binding IsConditionTypeEnabled}">
                        <TextBlock Text="条件タイプ:" VerticalAlignment="Center" Margin="0,0,5,0" Width="70" />
                        <ComboBox Width="200"
                                  ItemsSource="{Binding ConditionTypes}"
                                  SelectedItem="{Binding SelectedConditionType}"
                                  DisplayMemberPath="Name" />
                    </StackPanel>
                </StackPanel>

                <!-- 既存メッセージリスト -->
                <DataGrid Grid.Row="1" Margin="5"
                          ItemsSource="{Binding ErrorMessages}"
                          SelectedItem="{Binding SelectedErrorMessage}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          AlternatingRowBackground="#F9F9F9">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="AlarmId" Binding="{Binding AlarmId}" Width="60" />
                        <DataGridTextColumn Header="CondType" Binding="{Binding ConditionTypeId}" Width="60" />
                        <DataGridTextColumn Header="BaseMessage" Binding="{Binding BaseMessage}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- 右ペイン: 編集エリア -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- プレースホルダー選択 -->
            <GroupBox Grid.Row="0" Header="プレースホルダー" Margin="0,0,0,10">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- 基本プレースホルダー -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="基本:" VerticalAlignment="Center" Margin="0,0,5,5" />
                    <ComboBox Grid.Row="0" Grid.Column="1" Margin="0,0,10,5"
                              ItemsSource="{Binding AvailablePlaceholders}"
                              SelectedItem="{Binding SelectedPlaceholder}"
                              DisplayMemberPath="DisplayText" />
                    <Button Grid.Row="0" Grid.Column="2" Content="挿入" Width="60"
                            Command="{Binding InsertPlaceholderCommand}" Margin="0,0,0,5" />

                    <!-- IO情報プレースホルダー（Interlock専用） -->
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="IO情報:" VerticalAlignment="Center" Margin="0,0,5,5" />
                    <ComboBox Grid.Row="1" Grid.Column="1" Margin="0,0,10,5"
                              ItemsSource="{Binding IoPlaceholders}"
                              SelectedItem="{Binding SelectedIoPlaceholder}"
                              DisplayMemberPath="DisplayText"
                              IsEnabled="{Binding IoPlaceholders.Count}" />
                    <Button Grid.Row="1" Grid.Column="2" Content="挿入" Width="60"
                            Command="{Binding InsertIoPlaceholderCommand}" Margin="0,0,0,5"
                            IsEnabled="{Binding IoPlaceholders.Count}" />

                    <StackPanel Grid.Row="2" Grid.ColumnSpan="3" Orientation="Horizontal">
                        <TextBlock Text="挿入先: " VerticalAlignment="Center" />
                        <RadioButton x:Name="RadioBaseMessage" Content="BaseMessage" IsChecked="True" Checked="RadioButton_Checked" Margin="5,0" />
                        <RadioButton x:Name="RadioBaseAlarm" Content="BaseAlarm" Checked="RadioButton_Checked" Margin="5,0" />
                        <RadioButton x:Name="RadioCategory1" Content="Category1" Checked="RadioButton_Checked" Margin="5,0" />
                        <RadioButton x:Name="RadioCategory2" Content="Category2" Checked="RadioButton_Checked" Margin="5,0" />
                        <RadioButton x:Name="RadioCategory3" Content="Category3" Checked="RadioButton_Checked" Margin="5,0" />
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- 編集フィールド -->
            <GroupBox Grid.Row="1" Header="テンプレート編集" Margin="0,0,0,10">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="AlarmId:" VerticalAlignment="Center" />
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding AlarmId, UpdateSourceTrigger=PropertyChanged}" Margin="0,2" />

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="BaseMessage:" VerticalAlignment="Top" Margin="0,5,0,0" />
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding BaseMessage, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,2" AcceptsReturn="True" TextWrapping="Wrap" Height="180"
                             VerticalScrollBarVisibility="Auto"
                             GotFocus="BaseMessage_GotFocus" />

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="BaseAlarm:" VerticalAlignment="Center" />
                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding BaseAlarm, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,2" GotFocus="BaseAlarm_GotFocus" />

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Category1:" VerticalAlignment="Center" />
                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding Category1, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,2" GotFocus="Category1_GotFocus" />

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Category2:" VerticalAlignment="Center" />
                    <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding Category2, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,2" GotFocus="Category2_GotFocus" />

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Category3:" VerticalAlignment="Center" />
                    <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding Category3, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,2" GotFocus="Category3_GotFocus" />

                    <TextBlock Grid.Row="6" Grid.Column="0" Text="DefaultCountTime(ms):" VerticalAlignment="Center" />
                    <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding DefaultCountTime, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,2" Width="100" HorizontalAlignment="Left" />
                </Grid>
            </GroupBox>

            <!-- プレビュー -->
            <GroupBox Grid.Row="2" Header="プレビュー (サンプルデータで置換)">
                <TextBox Text="{Binding PreviewText, Mode=OneWay}"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         Background="#F5F5F5"
                         Margin="5" />
            </GroupBox>

            <!-- 操作ボタン -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,10,0,0">
                <Button Content="新規作成" Command="{Binding CreateNewCommand}" Width="100" Margin="0,0,10,0" />
                <Button Content="保存" Command="{Binding SaveCommand}" Width="100" Margin="0,0,10,0" />
                <Button Content="削除" Command="{Binding DeleteCommand}" Width="100" Margin="0,0,10,0" />
            </StackPanel>

            <!-- 閉じるボタン -->
            <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="閉じる" Command="{Binding CloseCommand}"
                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                        Width="100" />
            </StackPanel>
        </Grid>

        <!-- ローディングオーバーレイ -->
        <Grid Grid.ColumnSpan="2" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.Background>
                <SolidColorBrush Color="White" Opacity="0.7" />
            </Grid.Background>
            <TextBlock Text="読み込み中..." HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16" />
        </Grid>
    </Grid>
</Window>
